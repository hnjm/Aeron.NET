# install .net 6

```sh
wget https://dotnet.microsoft.com/download/dotnet/scripts/v1/dotnet-install.sh

sh dotnet-install.sh

sh dotnet-install.sh -c 3.1
```

# build aeron .net

```sh
cd src/

dotnet build -c Release

export DOTNET_ROOT=/home/ec2-user/.dotnet
```

# Install Java

```sh
curl -s "https://get.sdkman.io" | bash

sdk install java 17.0.4-amzn

java --add-opens java.base/sun.nio.ch=ALL-UNNAMED -cp media-driver.jar io.aeron.driver.MediaDriver
```

# Ipc Throughput

`Samples/Adaptive.Aeron.Samples.HelloWorld/bin/Release/net6.0/Adaptive.Aeron.Samples.HelloWorld`


## using .net core 3.1

```sh
Samples/Adaptive.Aeron.Samples.IpcThroughput/bin/Release/net6.0/Adaptive.Aeron.Samples.IpcThroughput 

dotnet build -c Release
```

```sh
Duration 1,000ms - 10,062,930 messages - 322,013,760 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,063,976 messages - 322,047,232 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,065,513 messages - 322,096,416 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,057,301 messages - 321,833,632 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,057,799 messages - 321,849,568 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,060,503 messages - 321,936,096 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,062,570 messages - 322,002,240 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,062,352 messages - 321,995,264 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,059,734 messages - 321,911,488 bytes, GC0 0, GC1 0, GC2 0
```

change the <TargetFramework/> to net6.0 

## enable pgo

```sh
export DOTNET_TieredPGO=1
export DOTNET_TieredCompilation=1
```

`Samples/Adaptive.Aeron.Samples.IpcThroughput/bin/Release/net6.0/Adaptive.Aeron.Samples.IpcThroughput`

```sh
Duration 1,000ms - 10,213,919 messages - 326,845,408 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,224,158 messages - 327,173,056 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,209,664 messages - 326,709,248 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,214,085 messages - 326,850,720 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,208,484 messages - 326,671,488 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,217,156 messages - 326,948,992 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,217,540 messages - 326,961,280 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,215,475 messages - 326,895,200 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,213,997 messages - 326,847,904 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,215,435 messages - 326,893,920 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,215,403 messages - 326,892,896 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,215,818 messages - 326,906,176 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 10,214,631 messages - 326,868,192 bytes, GC0 0, GC1 0, GC2 0
```

## enable full pgo

```sh
export DOTNET_TieredCompilation=1
export DOTNET_TieredPGO=1
export DOTNET_ReadyToRun=0
export DOTNET_TC_QuickJitForLoops=1
```

`Samples/Adaptive.Aeron.Samples.IpcThroughput/bin/Release/net6.0/Adaptive.Aeron.Samples.IpcThroughput`

it got worst!s

```sh
Duration 1,000ms - 9,712,664 messages - 310,805,248 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,599,971 messages - 307,199,072 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,598,906 messages - 307,164,992 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,599,212 messages - 307,174,784 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,599,644 messages - 307,188,608 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,599,941 messages - 307,198,112 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,620,496 messages - 307,855,872 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,620,412 messages - 307,853,184 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,617,560 messages - 307,761,920 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,626,352 messages - 308,043,264 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,622,331 messages - 307,914,592 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,623,699 messages - 307,958,368 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,624,201 messages - 307,974,432 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,627,595 messages - 308,083,040 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,625,282 messages - 308,009,024 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,627,834 messages - 308,090,688 bytes, GC0 0, GC1 0, GC2 0
```


## without PGO

```sh
export DOTNET_TieredPGO=0
export DOTNET_TieredCompilation=0
```

```sh
Duration 1,000ms - 9,471,702 messages - 303,094,464 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,473,014 messages - 303,136,448 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,475,162 messages - 303,205,184 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,474,305 messages - 303,177,760 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,432,768 messages - 301,848,576 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,465,044 messages - 302,881,408 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,467,925 messages - 302,973,600 bytes, GC0 0, GC1 0, GC2 0
Duration 1,000ms - 9,468,866 messages - 303,003,712 bytes, GC0 0, GC1 0, GC2 0
```

# Ping Pong Latency

## .NET 6


`Samples/Adaptive.Aeron.Samples.Pong/bin/Release/net6.0/Adaptive.Aeron.Samples.Pong`

`Samples/Adaptive.Aeron.Samples.Ping/bin/Release/net6.0/Adaptive.Aeron.Samples.Ping`


```sh
Histogram of RTT latencies in microseconds.
       Value     Percentile TotalCount 1/(1-Percentile)

       5.071 0.000000000000          1           1.00
       5.895 0.100000000000     103390           1.11
       5.983 0.200000000000     200997           1.25
       6.907 0.300000000000     302099           1.43
       6.995 0.400000000000     400670           1.67
       7.067 0.500000000000     500386           2.00
       7.099 0.550000000000     551219           2.22
       7.131 0.600000000000     605324           2.50
       7.159 0.650000000000     650895           2.86
       7.195 0.700000000000     700416           3.33
       7.251 0.750000000000     751570           4.00
       7.299 0.775000000000     775766           4.44
       7.419 0.800000000000     800024           5.00
       8.479 0.825000000000     825053           5.71
      24.015 0.850000000000     850120           6.67
      26.927 0.875000000000     875419           8.00
      27.247 0.887500000000     887863           8.89
      27.551 0.900000000000     900711          10.00
      27.935 0.912500000000     912813          11.43
      28.351 0.925000000000     925079          13.33
      28.703 0.937500000000     938062          16.00
      28.879 0.943750000000     944040          17.78
      29.135 0.950000000000     950408          20.00
      29.327 0.956250000000     956536          22.86
      29.647 0.962500000000     962564          26.67
      30.895 0.968750000000     968759          32.00
      34.399 0.971875000000     971876          35.56
      64.991 0.975000000000     975131          40.00
      65.247 0.978125000000     978526          45.71
      65.375 0.981250000000     981286          53.33
      65.535 0.984375000000     984916          64.00
      65.599 0.985937500000     986214          71.11
      65.727 0.987500000000     988164          80.00
      65.855 0.989062500000     989469          91.43
      66.047 0.990625000000     990774         106.67
      66.239 0.992187500000     992305         128.00
      66.367 0.992968750000     993647         142.22
      66.431 0.993750000000     994297         160.00
      66.495 0.994531250000     994930         182.86
      66.559 0.995312500000     995526         213.33
      66.687 0.996093750000     996473         256.00
      66.751 0.996484375000     996774         284.44
      66.815 0.996875000000     996983         320.00
      67.007 0.997265625000     997321         365.71
      67.647 0.997656250000     997665         426.67
      68.223 0.998046875000     998061         512.00
      68.799 0.998242187500     998268         568.89
      69.119 0.998437500000     998443         640.00
      69.887 0.998632812500     998650         731.43
      70.335 0.998828125000     998837         853.33
      70.911 0.999023437500     999048        1024.00
      71.231 0.999121093750     999135        1137.78
      71.743 0.999218750000     999221        1280.00
      72.959 0.999316406250     999319        1462.86
      74.815 0.999414062500     999418        1706.67
      78.655 0.999511718750     999512        2048.00
      81.855 0.999560546875     999561        2275.56
      85.951 0.999609375000     999613        2560.00
      89.535 0.999658203125     999659        2925.71
      98.175 0.999707031250     999709        3413.33
     111.039 0.999755859375     999756        4096.00
     113.599 0.999780273437     999781        4551.11
     116.479 0.999804687500     999805        5120.00
     127.935 0.999829101563     999830        5851.43
     139.007 0.999853515625     999854        6826.67
     169.471 0.999877929688     999878        8192.00
     175.359 0.999890136719     999891        9102.22
     189.055 0.999902343750     999903       10240.00
     199.423 0.999914550781     999915       11702.86
     247.423 0.999926757812     999927       13653.33
     288.767 0.999938964844     999939       16384.00
     326.143 0.999945068359     999946       18204.44
     369.663 0.999951171875     999952       20480.00
     417.791 0.999957275391     999958       23405.71
     558.079 0.999963378906     999964       27306.67
     739.327 0.999969482422     999970       32768.00
     780.799 0.999972534180     999973       36408.89
     808.447 0.999975585938     999976       40960.00
     920.063 0.999978637695     999979       46811.43
    1157.119 0.999981689453     999982       54613.33
    1320.959 0.999984741211     999985       65536.00
    1466.367 0.999986267090     999987       72817.78
    1488.895 0.999987792969     999988       81920.00
    1726.463 0.999989318848     999990       93622.86
    1785.855 0.999990844727     999991      109226.67
    2230.271 0.999992370605     999993      131072.00
    2279.423 0.999993133545     999994      145635.56
    2279.423 0.999993896484     999994      163840.00
    2363.391 0.999994659424     999995      187245.71
    2973.695 0.999995422363     999996      218453.33
    3041.279 0.999996185303     999997      262144.00
    3041.279 0.999996566772     999997      291271.11
    3041.279 0.999996948242     999997      327680.00
    3780.607 0.999997329712     999998      374491.43
    3780.607 0.999997711182     999998      436906.67
    3790.847 0.999998092651     999999      524288.00
    3790.847 0.999998283386     999999      582542.22
    3790.847 0.999998474121     999999      655360.00
    3790.847 0.999998664856     999999      748982.86
    3790.847 0.999998855591     999999      873813.33
    9191.423 0.999999046326    1000000     1048576.00
    9191.423 1.000000000000    1000000
#[Mean    =       11.191, StdDeviation   =       17.891]
#[Max     =     9191.423, Total count    =      1000000]
#[Buckets =           24, SubBuckets     =         2048]
```

# .NET 3.0


`Samples/Adaptive.Aeron.Samples.Pong/bin/Release/net6.0/Adaptive.Aeron.Samples.Pong`

`Samples/Adaptive.Aeron.Samples.Ping/bin/Release/net6.0/Adaptive.Aeron.Samples.Ping`

```sh
Histogram of RTT latencies in microseconds.
       Value     Percentile TotalCount 1/(1-Percentile)

       5.207 0.000000000000          1           1.00
       5.859 0.100000000000     103287           1.11
       5.967 0.200000000000     201673           1.25
       6.883 0.300000000000     303720           1.43
       6.959 0.400000000000     402328           1.67
       7.023 0.500000000000     503049           2.00
       7.051 0.550000000000     550823           2.22
       7.083 0.600000000000     606083           2.50
       7.111 0.650000000000     651073           2.86
       7.147 0.700000000000     700679           3.33
       7.199 0.750000000000     752049           4.00
       7.239 0.775000000000     776419           4.44
       7.315 0.800000000000     800235           5.00
       8.199 0.825000000000     825030           5.71
      16.343 0.850000000000     850000           6.67
      26.815 0.875000000000     875217           8.00
      27.295 0.887500000000     887713           8.89
      27.615 0.900000000000     900378          10.00
      28.015 0.912500000000     912790          11.43
      28.431 0.925000000000     925029          13.33
      28.735 0.937500000000     937709          16.00
      28.879 0.943750000000     944165          17.78
      29.039 0.950000000000     950482          20.00
      29.199 0.956250000000     956683          22.86
      29.359 0.962500000000     962708          26.67
      29.647 0.968750000000     968842          32.00
      30.047 0.971875000000     971895          35.56
      30.495 0.975000000000     975117          40.00
      31.071 0.978125000000     978152          45.71
      34.751 0.981250000000     981250          53.33
      65.119 0.984375000000     984592          64.00
      65.247 0.985937500000     986077          71.11
      65.343 0.987500000000     987702          80.00
      65.439 0.989062500000     989611          91.43
      65.503 0.990625000000     990849         106.67
      65.599 0.992187500000     992598         128.00
      65.663 0.992968750000     993594         142.22
      65.727 0.993750000000     994421         160.00
      65.791 0.994531250000     995175         182.86
      65.855 0.995312500000     995788         213.33
      65.919 0.996093750000     996315         256.00
      65.983 0.996484375000     996700         284.44
      66.047 0.996875000000     996983         320.00
      66.175 0.997265625000     997405         365.71
      66.303 0.997656250000     997706         426.67
      66.495 0.998046875000     998115         512.00
      66.623 0.998242187500     998280         568.89
      66.879 0.998437500000     998456         640.00
      69.247 0.998632812500     998633         731.43
      70.271 0.998828125000     998829         853.33
      71.039 0.999023437500     999033        1024.00
      72.383 0.999121093750     999127        1137.78
      74.175 0.999218750000     999219        1280.00
      79.999 0.999316406250     999317        1462.86
      86.783 0.999414062500     999418        1706.67
      88.767 0.999511718750     999515        2048.00
      90.303 0.999560546875     999561        2275.56
      91.583 0.999609375000     999612        2560.00
     104.767 0.999658203125     999659        2925.71
     108.543 0.999707031250     999709        3413.33
     109.247 0.999755859375     999756        4096.00
     110.143 0.999780273437     999781        4551.11
     112.639 0.999804687500     999807        5120.00
     115.519 0.999829101563     999830        5851.43
     133.887 0.999853515625     999854        6826.67
     165.887 0.999877929688     999878        8192.00
     172.159 0.999890136719     999891        9102.22
     180.095 0.999902343750     999903       10240.00
     198.399 0.999914550781     999915       11702.86
     227.839 0.999926757812     999927       13653.33
     258.815 0.999938964844     999939       16384.00
     295.423 0.999945068359     999946       18204.44
     320.511 0.999951171875     999952       20480.00
     388.095 0.999957275391     999958       23405.71
     460.543 0.999963378906     999964       27306.67
     602.623 0.999969482422     999970       32768.00
     744.447 0.999972534180     999973       36408.89
     848.383 0.999975585938     999976       40960.00
    1123.327 0.999978637695     999979       46811.43
    1377.279 0.999981689453     999982       54613.33
    1431.551 0.999984741211     999985       65536.00
    1561.599 0.999986267090     999987       72817.78
    1672.191 0.999987792969     999988       81920.00
    1779.711 0.999989318848     999990       93622.86
    1811.455 0.999990844727     999991      109226.67
    1939.455 0.999992370605     999993      131072.00
    1944.575 0.999993133545     999994      145635.56
    1944.575 0.999993896484     999994      163840.00
    2363.391 0.999994659424     999995      187245.71
    2543.615 0.999995422363     999996      218453.33
    2709.503 0.999996185303     999997      262144.00
    2709.503 0.999996566772     999997      291271.11
    2709.503 0.999996948242     999997      327680.00
    2756.607 0.999997329712     999998      374491.43
    2756.607 0.999997711182     999998      436906.67
    2760.703 0.999998092651     999999      524288.00
    2760.703 0.999998283386     999999      582542.22
    2760.703 0.999998474121     999999      655360.00
    2760.703 0.999998664856     999999      748982.86
    2760.703 0.999998855591     999999      873813.33
    2762.751 0.999999046326    1000000     1048576.00
    2762.751 1.000000000000    1000000
#[Mean    =       10.699, StdDeviation   =       14.212]
#[Max     =     2762.751, Total count    =      1000000]
#[Buckets =           24, SubBuckets     =         2048]
```

- [ ] test disable TC on .NET 6 its on by default
